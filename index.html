<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚´ ìœ„ì¹˜ ê³µìœ í•˜ê¸°</title>
</head>
<body>
  <h2>ğŸ“ í¬ë ˆë””í†¡ ë‚´ ìœ„ì¹˜ ê³µìœ  ì„œë¹„ìŠ¤ ğŸ“</h2>
  <button onclick="shareLocation()">ë‚´ ìœ„ì¹˜ í™•ì¸í•˜ê¸°</button>
  <div id="result"></div>

  <script>
    let timeoutCheck;

    function shareLocation() {
      if (navigator.geolocation) {
        document.getElementById('result').innerHTML = "<p>ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>";

        // 10ì´ˆ í›„ì—ë„ ìœ„ì¹˜ê°€ ë¡œë“œë˜ì§€ ì•Šìœ¼ë©´ ë²„íŠ¼ ì¶”ê°€
        timeoutCheck = setTimeout(function(){
          document.getElementById('result').innerHTML +=
          '<button onclick="retryAccess()">ìœ„ì¹˜ ì •ë³´ê°€ ë‚˜ì˜¤ì§€ ì•Šë‚˜ìš”?</button>';
        }, 10000);

        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        alert("Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
      }
    }

    function showPosition(position) {
      clearTimeout(timeoutCheck); // ìœ„ì¹˜ ì„±ê³µ ì‹œ íƒ€ì„ì•„ì›ƒ ì œê±°

      var lat = position.coords.latitude;
      var lon = position.coords.longitude;
      var googleMapsUrl = "https://www.google.com/maps?q=" + lat + "," + lon;
      var resultDiv = document.getElementById('result');

      resultDiv.innerHTML =
        '<p>í¬ë ˆë””í†¡ ë‚´ ìœ„ì¹˜ ê³µìœ  ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>' +
        '<p>ë³¸ ì„œë¹„ìŠ¤ëŠ” ë²•ì  ê·¼ê±°ìë£Œ ë“±ìœ¼ë¡œ í™œìš©ë  ìˆ˜ ì—†ìœ¼ë‹ˆ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ í™œìš©í•˜ì„¸ìš”.</p>' +
        '<p>ì•„ë˜ ì£¼ì†Œë¥¼ ìƒëŒ€ë°©ì—ê²Œ ë©”ì‹œì§€ë¡œ ê³µìœ í•˜ì—¬ ë‚´ ìœ„ì¹˜ë¥¼ ê³µìœ í•˜ì„¸ìš”.</p>' +
        '<input type="text" value="' + googleMapsUrl + '" id="link" style="width:80%;" readonly>' +
        '<button onclick="copyLink()">ë³µì‚¬í•˜ê¸°</button>' +
        '<p>Copyright (C) í•œêµ­ê¸ˆìœµë²”ì£„ì˜ˆë°©ì—°êµ¬ì„¼í„°. All rights reserved.</p>';
    }

    function copyLink() {
      var linkInput = document.getElementById('link');
      linkInput.select();
      linkInput.setSelectionRange(0, 99999);
      document.execCommand('copy');
      alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    function showError(error) {
      clearTimeout(timeoutCheck); // ìœ„ì¹˜ ì‹¤íŒ¨ ì‹œ íƒ€ì„ì•„ì›ƒ ì œê±°

      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("ìœ„ì¹˜ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          break;
        case error.TIMEOUT:
          alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.");
          break;
        default:
          alert("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }

      document.getElementById('result').innerHTML = "";
    }

    function retryAccess() {
      // ì•±ì—ì„œ ë¦¬ë‹¤ì´ë ‰ì…˜ëœ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê¸° ìœ„í•´ ë‹¤ì‹œ ì‚¬ì´íŠ¸ë¥¼ ë¡œë”©
      window.location.href = 'https://creditplacecheck.netlify.app';
    }
  </script>
</body>
</html>
